#!/bin/bash

## Customizes the image while it is being created

# Configure netplan to delegate all interfaces to NetworkManager
cat << EOF > /etc/netplan/01-network-manager-all.yaml
# This file was written by a customization script during image creation.
# Let NetworkManager manage all devices on this system.
# For more information, see netplan(5).
network:
  version: 2
  renderer: NetworkManager
EOF
chmod 600 /etc/netplan/01-network-manager-all.yaml

{% if kubuntu_image_minimal %}
# Remove some packages, creating a minimal installation
# Borrowed from calamares
DEBIAN_FRONTEND=noninteractive apt-get -y --purge remove kmahjongg kmines kpat ksudoku skanlite skanpage okular libreoffice* kdeconnect krdc konversation neochat elisa haruna vim snapd partitionmanager usb-creator* plasma-welcome kde-config-tablet plasma-welcome
apt-get -y autoremove
{% endif %}

# Delete self
rm "$0"
